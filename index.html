<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unified Financial Analyzer — F-Score + ROIC/Growth + Swing Trade Quality</title>
<style>
  :root {
    --bg: #0b0f14;
    --fg: #e8eef4;
    --muted:#9fb3c8;
    --card:#0f1620;
    --accent:#f59e0b;
    --ring:#f59e0b;
    --good:#16a34a;
    --bad:#dc2626;
    --warn:#f59e0b;
    --link:#60a5fa;
    --chip:#0b1322;
    --chip-border:#25324a;
    --table:#0e1727;
    --input:#0f172a;
  }
  .light {
    --bg: #f6f8fb;
    --fg: #0b1220;
    --muted:#4b5563;
    --card:#ffffff;
    --accent:#0a47a3;
    --ring:#0a47a3;
    --good:#15803d;
    --bad:#b91c1c;
    --warn:#b45309;
    --link:#1d4ed8;
    --chip:#eef2ff;
    --chip-border:#c7d2fe;
    --table:#f3f6ff;
    --input:#eef2ff;
  }
  * { box-sizing: border-box; }
  html, body { height:100%; }
  body {
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 600px at 30% -10%, rgba(245,158,11,.12), transparent 60%),
                radial-gradient(1000px 600px at 120% 10%, rgba(10,71,163,.12), transparent 60%),
                var(--bg);
    color: var(--fg);
    line-height: 1.4;
  }
  header {
    max-width:1240px; margin:24px auto 8px; padding:0 16px;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .title { font-weight: 800; letter-spacing:.2px; }
  .muted { color: var(--muted); }
  .container { max-width:1240px; margin: 0 auto; padding: 8px 16px 80px; }
  .grid { display:grid; gap:16px; }
  @media(min-width:1000px){ .grid-cols-2 { grid-template-columns: 1fr 1fr; } }
  .card {
    background: var(--card);
    border: 1px solid rgba(148,163,184,.18);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,.18);
  }
  .row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
  label { font-weight: 600; display:block; margin-bottom:6px; }
  .input, select, textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    outline: none;
    border: 2px solid var(--ring);
    background: var(--input);
    color: var(--fg);
  }
  .input.round { border-radius: 999px; background: transparent; }
  textarea { min-height: 88px; }
  .btn {
    padding: 10px 14px;
    border-radius: 999px;
    border: 2px solid var(--ring);
    background: transparent;
    color: var(--fg);
    cursor: pointer;
    font-weight: 700;
  }
  .btn:hover { filter: brightness(1.08); }
  .small { font-size: 12px; }
  .kpi { display:grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px 12px; border-radius: 12px; border:1px dashed rgba(148,163,184,.35); }
  .kpi.good { border-color: rgba(22,163,74,.5); background: rgba(22,163,74,.08); }
  .kpi.bad { border-color: rgba(220,38,38,.5); background: rgba(220,38,38,.08); }
  .kpi.na { border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.08); }
  .kpi .score { font-weight: 800; }
  .right { text-align: right; }
  .status-grid { display:grid; grid-template-columns: 1.2fr .8fr .8fr; gap: 8px; }
  .pill { padding:6px 10px; border-radius:999px; border:1px solid rgba(148,163,184,.35); font-size:12px; display:inline-block; }
  .pill.ok { color: var(--good); border-color: rgba(22,163,74,.55); }
  .pill.warn { color: var(--warn); border-color: rgba(245,158,11,.55); }
  .pill.bad { color: var(--bad); border-color: rgba(220,38,38,.55); }
  .help {
    position: relative; display:inline-block; margin-left: 8px; font-size: 12px; cursor: pointer; color: var(--link); text-decoration: underline;
  }
  .popover {
    position: absolute; top: 20px; left: 0; z-index: 10; min-width: 280px; max-width: 380px;
    background: var(--card); border: 1px solid rgba(148,163,184,.3); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.25); padding: 12px; display: none;
  }
  .help:hover .popover { display: block; }
  .alert { border:1px solid; padding:10px 12px; border-radius:12px; margin: 8px 0; }
  .alert.warn { border-color: rgba(245,158,11,.55); color: var(--warn); background: rgba(245,158,11,.08); }
  .alerts { max-width:1240px; margin:0 auto; padding:0 16px; }
  .tag { border:1px solid rgba(148,163,184,.35); padding:4px 10px; border-radius:999px; font-size:12px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
  .chip { background: var(--chip); border:1px solid var(--chip-border); border-radius:12px; padding:8px 12px; font-size:12px; color:#dbeafe; font-weight:700; display:inline-flex; gap:8px; align-items:center; }
  .chip.ok{ border-color:#1d3b2a; background:#0a1610; color:#b4f5c3 }
  .chip.warn{ border-color:#4d3d17; background:#161207; color:#ffe4a3 }
  .chip.bad{ border-color:#502525; background:#160a0a; color:#ffb4b4 }

  .table{ width:100%; border-collapse:separate; border-spacing:0 6px; margin-top:6px; font-size:13px; color:#cbd5e1; }
  .table th{ text-align:left; color:#9fb2d8; font-weight:700; }
  .table td,.table th{ padding:6px 10px; }
  .table tr{ background:var(--table); }
  .table tr td:first-child, .table tr th:first-child{ border-radius:10px 0 0 10px }
  .table tr td:last-child, .table tr th:last-child{ border-radius:0 10px 10px 0 }

  .fieldset{ display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
  .full { grid-column: 1 / -1; }

  /* Notes toggler */
  .note-wrap{ position:relative; }
  .note-toggle{ margin-left:8px; font-size:11px; cursor:pointer; color:var(--link); text-decoration:underline; }
  .note-box{ display:none; margin-top:8px; border:1px solid rgba(245,158,11,.55); background:linear-gradient(180deg, rgba(245,158,11,.06), rgba(245,158,11,.02)); border-radius:12px; padding:8px; }
  .note-head{ font-size:12px; font-weight:800; letter-spacing:.3px; color:#ffd89a; display:flex; align-items:center; gap:6px; margin-bottom:6px; }
  .note-box textarea{ width:100%; min-height:70px; resize:vertical; padding:10px 12px; border-radius:10px; border:1px solid #3b2b12; outline:none; background:var(--input); color:var(--fg); }
  .missing { box-shadow: 0 0 0 3px rgba(220,38,38,.35) inset; }

  .footer { margin-top: 24px; font-size: 12px; color: var(--muted); text-align: center; }

/* Unified Inputs: 3-column compact layout (Label | Current | Last) */
.uni-grid{display:grid;gap:10px}
.uni-row{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:10px;align-items:center}
.uni-row label{margin:0;font-weight:600}
@media(max-width:880px){.uni-row{grid-template-columns:1fr}}
/* Unified Inputs spacing: label | current | last */
.uni-grid{row-gap:18px;}
.uni-row{
  grid-template-columns: minmax(220px,1.2fr) minmax(220px,1fr) minmax(220px,1fr);
  column-gap:24px;
  align-items:start;
  padding:6px 0;
}
.uni-row .input{width:100%;}
@media (max-width:1200px){
  .uni-row{
    grid-template-columns: 1fr 1fr;
    row-gap:10px;
    column-gap:16px;
  }
  .uni-row > label{grid-column:1/-1;}
}
@media (max-width:760px){
  .uni-row{grid-template-columns:1fr; row-gap:8px;}
}
/* Make Unified Inputs span full width so Additional starts below */
.fieldset > .uni-grid{ grid-column: 1 / -1; }
/* Make Unified Inputs use full width and avoid clipping */
.fieldset:has(> .uni-grid){overflow:visible;}
.fieldset > .uni-grid{
  grid-column:1 / -1;
  width:100%;
  margin-top:8px;
}

/* Roomy, flexible columns that won't hide text */
.uni-grid{row-gap:18px;}
.uni-row{
  grid-template-columns: minmax(0,1.25fr) minmax(0,1fr) minmax(0,1fr);
  column-gap:20px;
  align-items:start;
}
.uni-row > label{white-space:normal; line-height:1.25;}
.uni-row .input{width:100%; max-width:100%;}

/* Responsive: wrap label or stack on smaller screens */
@media (max-width:1200px){
  .uni-row{grid-template-columns:1fr 1fr; row-gap:10px; column-gap:16px;}
  .uni-row > label{grid-column:1/-1;}
}
@media (max-width:760px){
  .uni-row{grid-template-columns:1fr; row-gap:8px;}
}
/* Make the note span under both inputs */
.uni-row .note-wrap{display: contents;}
.uni-row .note-toggle{grid-column: 2; grid-row: 2;}
.uni-row .note-box{
  grid-column: 2 / 4;   /* spans current + last */
  grid-row: 3;          /* sits below the toggles */
  width: 100%;
  margin-top: 4px;
}

/* Tab system */
.tab-nav {
  display: flex;
  margin-bottom: 20px;
  border-bottom: 2px solid rgba(148,163,184,.18);
}
.tab-btn {
  padding: 12px 24px;
  background: none;
  border: none;
  color: var(--muted);
  cursor: pointer;
  font-weight: 600;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}
.tab-btn.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}
.tab-btn:hover {
  color: var(--fg);
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

/* Swing Trade specific styles */
.swing-pill {
  display: inline-flex;
  align-items: center;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 14px;
  font-weight: 600;
  border: 1px solid rgba(148,163,184,.35);
}
.swing-pill.entry-ok {
  background: var(--good);
  color: white;
  border-color: var(--good);
}
.swing-pill.entry-not-ok {
  background: rgba(148,163,184,.35);
  color: var(--muted);
}
.score-display {
  font-size: 48px;
  font-weight: 800;
  line-height: 1;
}
.score-bar {
  height: 12px;
  border-radius: 6px;
  background: rgba(148,163,184,.2);
  overflow: hidden;
}
.score-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--bad), var(--warn), var(--good));
  transition: width 0.3s ease;
}
.metric-card {
  padding: 12px;
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 12px;
  background: rgba(148,163,184,.05);
}
.metric-label {
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 4px;
}
.metric-value {
  font-size: 20px;
  font-weight: 700;
}

/* Risk management styles */
.risk-switch {
  display: inline-flex;
  background: rgba(148,163,184,.1);
  border-radius: 999px;
  padding: 4px;
  position: relative;
}
.risk-switch-btn {
  padding: 8px 16px;
  background: none;
  border: none;
  color: var(--muted);
  cursor: pointer;
  border-radius: 999px;
  font-weight: 600;
  transition: all 0.2s;
  position: relative;
  z-index: 2;
}
.risk-switch-btn.active {
  color: var(--fg);
}
.risk-switch-indicator {
  position: absolute;
  top: 4px;
  left: 4px;
  height: calc(100% - 8px);
  background: var(--card);
  border-radius: 999px;
  transition: all 0.3s ease;
  border: 1px solid rgba(148,163,184,.18);
}

</style>

</head>
<body data-theme="dark">
  <header>
    <div>
      <div class="title">Unified Financial Analyzer</div>
      <div class="muted small">Stock Evaluation + Swing Trade Quality — Comprehensive analysis toolkit.</div>
    </div>
    <div class="row">
      <button id="downloadHtml" class="btn small">Download (.html)</button>
      <label class="row small muted" style="gap:8px;">
        <span>Light</span>
        <input id="themeToggle" type="checkbox" />
        <span class="pill">Theme</span>
      </label>
      <label class="row small muted" style="gap:8px;">
        <span>Debug</span>
        <input id="debugToggle" type="checkbox" />
        <span class="pill">Show</span>
      </label>
    </div>
  </header>

  <div id="alerts" class="alerts"></div>

  <div class="container">
    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="stock-evaluation">Stock Evaluation (F-Score + ROIC)</button>
      <button class="tab-btn" data-tab="swing-trading">Swing Trade Quality</button>
    </nav>

    <!-- Stock Evaluation Tab -->
    <div id="stock-evaluation" class="tab-content active">
      <details class="card" id="helpCard">
        <summary><strong>Help</strong> <span class="small muted">How to use, meanings, and tips</span></summary>
        <div class="grid" style="grid-template-columns: 1fr; gap:10px; margin-top:8px;">
          <div>
            <label>Workflow</label>
            <ul style="margin:6px 0 0 18px">
              <li>Enter a ticker and your API key(s). Keys are hidden; toggle the eye icon to view.</li>
              <li>Click Fetch via Finnhub or Fetch via FMP to auto-fill current and prior year fields.</li>
              <li>Fill any missing inputs manually. Red highlights show blanks.</li>
              <li>Press Compute All to update F-Score, ROIC, Growth, and the Composite Verdict.</li>
            </ul>
          </div>
          <div>
            <label>Piotroski F-Score (0—9)</label>
            <p class="small muted">Nine binary checks. 1 point per pass; 0 if fail; — if missing.</p>
            <ul style="margin:6px 0 0 18px">
              <li>Profitability: ROA > 0; CFO > 0; ΔROA > 0; Accruals: CFO > NI.</li>
              <li>Leverage/Liquidity: LT Debt / Assets decreases; Current Ratio increases; No new shares (sh0 ≤ sh1).</li>
              <li>Operating efficiency: Gross Margin increases; Asset Turnover increases.</li>
              <li>Reading the score: 0—3 weak, 4—6 average, 7—9 strong.</li>
            </ul>
          </div>
          <div>
            <label>ROIC</label>
            <p class="small muted">ROIC ≈ NOPAT / Invested Capital, using operating capital items. Positive spread over WACC suggests value creation.</p>
          </div>
          <div>
            <label>Growth</label>
            <p class="small muted">Cumulative 4-year growth from user/API YoY % values. Classes: Poor (<25), Below avg (25—29), Acceptable (30—49), Decent (50—59), Strong (60—79), Excellent (80—120), Outlier (>120).</p>
          </div>
          <div>
            <label>Composite Verdict</label>
            <ul style="margin:6px 0 0 18px">
              <li>Combines F-Score, ROIC−WACC spread, and Growth class.</li>
              <li>Requires WACC to judge value creation (spread).</li>
              <li>Outputs a plain-English verdict and reasons.</li>
            </ul>
          </div>
          <div class="small muted">
            Tips: If APIs block file:// requests, run a local server (python -m http.server). Use notes on each field to record assumptions and sources.
          </div>
        </div>
      </details>

      <div class="grid grid-cols-2">
      <!-- LEFT: Inputs & Fetch -->
      <section class="card">
        <div class="row">
          <label for="ticker">Ticker</label>
          <span class="help">what is this?
            <span class="popover">Enter a 1—5 letter ticker symbol (e.g., AAPL, MSFT, GOOG). Uppercase A—Z.</span>
          </span>
        </div>
        <input id="ticker" class="input round mono" maxlength="5" placeholder="e.g., AAPL" pattern="[A-Z]{1,5}" />

        <div style="height:12px"></div>
        <div class="row"><span class="tag">Data Sources</span></div>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
          <div class="card" style="padding:12px;">
            <div class="row" style="justify-content:space-between;">
              <strong>Finnhub</strong>
              <a class="small" href="https://finnhub.io" target="_blank" rel="noopener">Get key</a>
            </div>
            <label class="small muted" for="finnhubKey">API Key</label>
            <div class="row" style="gap:8px;"><input id="finnhubKey" type="password" class="input mono" placeholder="FINNHUB_API_KEY" /><button class="btn small" id="toggleFinnhubKey" title="Show/Hide">👁</button></div>
            <div style="height:8px"></div>
            <button class="btn" id="btnFinnhub">Fetch via Finnhub</button>
            <p class="small muted">Primary: financials-reported; Optional: metric for shares.</p>
          </div>

          <div class="card" style="padding:12px;">
            <div class="row" style="justify-content:space-between;">
              <strong>FMP</strong>
              <a class="small" href="https://site.financialmodelingprep.com/developer" target="_blank" rel="noopener">Get key</a>
            </div>
            <label class="small muted" for="fmpKey">API Key</label>
            <div class="row" style="gap:8px;"><input id="fmpKey" type="password" class="input mono" placeholder="FMP_API_KEY" /><button class="btn small" id="toggleFmpKey" title="Show/Hide">👁</button></div>
            <div style="height:8px"></div>
            <button class="btn" id="btnFmp">Fetch via FMP</button>
            <p class="small muted">Quiet build: marks missing as manual.</p>
          </div>
        </div>
        <div style="height:12px"></div>
        <button class="btn" id="btnSec">Fetch via SEC</button>
        <p class="small muted">Direct from SEC via your Vercel proxy.</p>
        <div style="height:12px"></div>

        <!-- Unified Inputs -->
        <details open class="card">
          <summary><strong>Unified Inputs</strong> <span class="small muted">(auto-fill or manual; reused across all metrics)</span></summary>
          <div class="fieldset"><div class="uni-grid">
      <div class="uni-row">
        <label>Revenue / Sales</label>
        <div class="note-wrap">
          <input id="rev0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_rev0">note</span>
          <div class="note-box" id="note_rev0_box"><div class="note-head">Revenue / Sales note</div><textarea id="note_rev0"></textarea></div>
        </div>
        <div>
          <input id="rev1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Gross Profit</label>
        <div class="note-wrap">
          <input id="gp0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_gp0">note</span>
          <div class="note-box" id="note_gp0_box"><div class="note-head">Gross Profit note</div><textarea id="note_gp0"></textarea></div>
        </div>
        <div>
          <input id="gp1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Total Assets</label>
        <div class="note-wrap">
          <input id="assets0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_assets0">note</span>
          <div class="note-box" id="note_assets0_box"><div class="note-head">Total Assets note</div><textarea id="note_assets0"></textarea></div>
        </div>
        <div>
          <input id="assets1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Net Income</label>
        <div class="note-wrap">
          <input id="ni0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_ni0">note</span>
          <div class="note-box" id="note_ni0_box"><div class="note-head">Net Income note</div><textarea id="note_ni0"></textarea></div>
        </div>
        <div>
          <input id="ni1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Operating Cash Flow (CFO)</label>
        <div class="note-wrap">
          <input id="cfo0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_cfo0">note</span>
          <div class="note-box" id="note_cfo0_box"><div class="note-head">Operating Cash Flow (CFO) note</div><textarea id="note_cfo0"></textarea></div>
        </div>
        <div>
          <input id="cfo1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Long-term Debt</label>
        <div class="note-wrap">
          <input id="ltd0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_ltd0">note</span>
          <div class="note-box" id="note_ltd0_box"><div class="note-head">Long-term Debt note</div><textarea id="note_ltd0"></textarea></div>
        </div>
        <div>
          <input id="ltd1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Current Assets</label>
        <div class="note-wrap">
          <input id="ca0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_ca0">note</span>
          <div class="note-box" id="note_ca0_box"><div class="note-head">Current Assets note</div><textarea id="note_ca0"></textarea></div>
        </div>
        <div>
          <input id="ca1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Current Liabilities</label>
        <div class="note-wrap">
          <input id="cl0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_cl0">note</span>
          <div class="note-box" id="note_cl0_box"><div class="note-head">Current Liabilities note</div><textarea id="note_cl0"></textarea></div>
        </div>
        <div>
          <input id="cl1" class="input mono" placeholder="last year" />
        </div>
      </div>

      <div class="uni-row">
        <label>Shares Outstanding (weighted avg)</label>
        <div class="note-wrap">
          <input id="sh0" class="input mono" placeholder="current year" />
          <span class="note-toggle" data-for="note_sh0">note</span>
          <div class="note-box" id="note_sh0_box"><div class="note-head">Shares Outstanding (weighted avg) note</div><textarea id="note_sh0"></textarea></div>
        </div>
        <div>
          <input id="sh1" class="input mono" placeholder="last year" />
        </div>
      </div>
  </div>
  <div class="full"><h4>Additional (for ROIC / Debt / Margins / Growth)</h4></div>
            <div class="note-wrap">
              <label>EBIT</label>
              <input id="ebit" class="input mono" placeholder="e.g., 1254" />
              <span class="note-toggle" data-for="note_ebit">note</span>
              <div class="note-box" id="note_ebit_box"><div class="note-head">EBIT note</div><textarea id="note_ebit"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>EBITDA</label>
              <input id="ebitda" class="input mono" placeholder="e.g., 1571" />
              <span class="note-toggle" data-for="note_ebitda">note</span>
              <div class="note-box" id="note_ebitda_box"><div class="note-head">EBITDA note</div><textarea id="note_ebitda"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Income Tax</label>
              <input id="tax" class="input mono" placeholder="e.g., 152" />
              <span class="note-toggle" data-for="note_tax">note</span>
              <div class="note-box" id="note_tax_box"><div
