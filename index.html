<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Unified Financial Analyzer — F-Score + ROIC/Growth + Swing Trade Quality</title>
<style>
  :root {
    --bg: #0b0f14;
    --fg: #e8eef4;
    --muted:#9fb3c8;
    --card:#0f1620;
    --accent:#f59e0b;
    --ring:#f59e0b;
    --good:#16a34a;
    --bad:#dc2626;
    --warn:#f59e0b;
    --link:#60a5fa;
    --chip:#0b1322;
    --chip-border:#25324a;
    --table:#0e1727;
    --input:#0f172a;
  }
  .light {
    --bg: #f6f8fb;
    --fg: #0b1220;
    --muted:#4b5563;
    --card:#ffffff;
    --accent:#0a47a3;
    --ring:#0a47a3;
    --good:#15803d;
    --bad:#b91c1c;
    --warn:#b45309;
    --link:#1d4ed8;
    --chip:#eef2ff;
    --chip-border:#c7d2fe;
    --table:#f3f6ff;
    --input:#eef2ff;
  }
  * { box-sizing: border-box; }
  html, body { height:100%; }
  body {
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 600px at 30% -10%, rgba(245,158,11,.12), transparent 60%),
                radial-gradient(1000px 600px at 120% 10%, rgba(10,71,163,.12), transparent 60%),
                var(--bg);
    color: var(--fg);
    line-height: 1.4;
  }
  header {
    max-width:1240px; margin:24px auto 8px; padding:0 16px;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .title { font-weight: 800; letter-spacing:.2px; }
  .muted { color: var(--muted); }
  .container { max-width:1240px; margin: 0 auto; padding: 8px 16px 80px; }
  .grid { display:grid; gap:16px; }
  @media(min-width:1000px){ .grid-cols-2 { grid-template-columns: 1fr 1fr; } }
  .card {
    background: var(--card);
    border: 1px solid rgba(148,163,184,.18);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,.18);
  }
  .row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
  label { font-weight: 600; display:block; margin-bottom:6px; }
  .input, select, textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    outline: none;
    border: 2px solid var(--ring);
    background: var(--input);
    color: var(--fg);
  }
  .input.round { border-radius: 999px; background: transparent; }
  textarea { min-height: 88px; }
  .btn {
    padding: 10px 14px;
    border-radius: 999px;
    border: 2px solid var(--ring);
    background: transparent;
    color: var(--fg);
    cursor: pointer;
    font-weight: 700;
  }
  .btn:hover { filter: brightness(1.08); }
  .small { font-size: 12px; }
  .kpi { display:grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px 12px; border-radius: 12px; border:1px dashed rgba(148,163,184,.35); }
  .kpi.good { border-color: rgba(22,163,74,.5); background: rgba(22,163,74,.08); }
  .kpi.bad { border-color: rgba(220,38,38,.5); background: rgba(220,38,38,.08); }
  .kpi.na { border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.08); }
  .kpi .score { font-weight: 800; }
  .right { text-align: right; }
  .status-grid { display:grid; grid-template-columns: 1.2fr .8fr .8fr; gap: 8px; }
  .pill { padding:6px 10px; border-radius:999px; border:1px solid rgba(148,163,184,.35); font-size:12px; display:inline-block; }
  .pill.ok { color: var(--good); border-color: rgba(22,163,74,.55); }
  .pill.warn { color: var(--warn); border-color: rgba(245,158,11,.55); }
  .pill.bad { color: var(--bad); border-color: rgba(220,38,38,.55); }
  .help {
    position: relative; display:inline-block; margin-left: 8px; font-size: 12px; cursor: pointer; color: var(--link); text-decoration: underline;
  }
  .popover {
    position: absolute; top: 20px; left: 0; z-index: 10; min-width: 280px; max-width: 380px;
    background: var(--card); border: 1px solid rgba(148,163,184,.3); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.25); padding: 12px; display: none;
  }
  .help:hover .popover { display: block; }
  .alert { border:1px solid; padding:10px 12px; border-radius:12px; margin: 8px 0; }
  .alert.warn { border-color: rgba(245,158,11,.55); color: var(--warn); background: rgba(245,158,11,.08); }
  .alerts { max-width:1240px; margin:0 auto; padding:0 16px; }
  .tag { border:1px solid rgba(148,163,184,.35); padding:4px 10px; border-radius:999px; font-size:12px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
  .chip { background: var(--chip); border:1px solid var(--chip-border); border-radius:12px; padding:8px 12px; font-size:12px; color:#dbeafe; font-weight:700; display:inline-flex; gap:8px; align-items:center; }
  .chip.ok{ border-color:#1d3b2a; background:#0a1610; color:#b4f5c3 }
  .chip.warn{ border-color:#4d3d17; background:#161207; color:#ffe4a3 }
  .chip.bad{ border-color:#502525; background:#160a0a; color:#ffb4b4 }

  .table{ width:100%; border-collapse:separate; border-spacing:0 6px; margin-top:6px; font-size:13px; color:#cbd5e1; }
  .table th{ text-align:left; color:#9fb2d8; font-weight:700; }
  .table td,.table th{ padding:6px 10px; }
  .table tr{ background:var(--table); }
  .table tr td:first-child, .table tr th:first-child{ border-radius:10px 0 0 10px }
  .table tr td:last-child, .table tr th:last-child{ border-radius:0 10px 10px 0 }

  .fieldset{ display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
  .full { grid-column: 1 / -1; }

  /* Notes toggler */
  .note-wrap{ position:relative; }
  .note-toggle{ margin-left:8px; font-size:11px; cursor:pointer; color: var(--link); text-decoration:underline; }
  .note-box{ display:none; margin-top:8px; border:1px solid rgba(245,158,11,.55); background:linear-gradient(180deg, rgba(245,158,11,.06), rgba(245,158,11,.02)); border-radius:12px; padding:8px; }
  .note-head{ font-size:12px; font-weight:800; letter-spacing:.3px; color:#ffd89a; display:flex; align-items:center; gap:6px; margin-bottom:6px; }
  .note-box textarea{ width:100%; min-height:70px; resize:vertical; padding:10px 12px; border-radius:10px; border:1px solid #3b2b12; outline:none; background:var(--input); color: var(--fg); }
  .missing { box-shadow: 0 0 0 3px rgba(220,38,38,.35) inset; }

  .footer { margin-top: 24px; font-size: 12px; color: var(--muted); text-align: center; }

  /* Unified Inputs: 3-column compact layout (Label | Current | Last) */
  .uni-grid{display:grid;gap:10px}
  .uni-row{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:10px;align-items:center}
  .uni-row label{margin:0;font-weight:600}
  @media(max-width:880px){.uni-row{grid-template-columns:1fr}}
  /* Unified Inputs spacing: label | current | last */
  .uni-grid{row-gap:18px;}
  .uni-row{
    grid-template-columns: minmax(220px,1.2fr) minmax(220px,1fr) minmax(220px,1fr);
    column-gap:24px;
    align-items:start;
    padding:6px 0;
  }
  .uni-row .input{width:100%;}
  @media (max-width:1200px){
    .uni-row{
      grid-template-columns: 1fr 1fr;
      row-gap:10px;
      column-gap:16px;
    }
    .uni-row > label{grid-column:1/-1;}
  }
  @media (max-width:760px){
    .uni-row{grid-template-columns:1fr; row-gap:8px;}
  }
  /* Make Unified Inputs span full width so Additional starts below */
  .fieldset > .uni-grid{ grid-column: 1 / -1; }
  /* Make Unified Inputs use full width and avoid clipping */
  .fieldset:has(> .uni-grid){overflow:visible;}
  .fieldset > .uni-grid{
    grid-column:1 / -1;
    width:100%;
    margin-top:8px;
  }

  /* Roomy, flexible columns that won't hide text */
  .uni-grid{row-gap:18px;}
  .uni-row{
    grid-template-columns: minmax(0,1.25fr) minmax(0,1fr) minmax(0,1fr);
    column-gap:20px;
    align-items:start;
  }
  .uni-row > label{white-space:normal; line-height:1.25;}
  .uni-row .input{width:100%; max-width:100%;}

  /* Responsive: wrap label or stack on smaller screens */
  @media (max-width:1200px){
    .uni-row{grid-template-columns:1fr 1fr; row-gap:10px; column-gap:16px;}
    .uni-row > label{grid-column:1/-1;}
  }
  @media (max-width:760px){
    .uni-row{grid-template-columns:1fr; row-gap:8px;}
  }
  /* Make the note span under both inputs */
  .uni-row .note-wrap{display: contents;}
  .uni-row .note-toggle{grid-column: 2; grid-row: 2;}
  .uni-row .note-box{
    grid-column: 2 / 4;   /* spans current + last */
    grid-row: 3;          /* sits below the toggles */
    width: 100%;
    margin-top: 4px;
  }

  /* Tab system */
  .tab-nav {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 2px solid rgba(148,163,184,.18);
  }
  .tab-btn {
    padding: 12px 24px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-weight: 600;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
  }
  .tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }
  .tab-btn:hover {
    color: var(--fg);
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }

  /* Swing Trade specific styles */
  .swing-pill {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 14px;
    font-weight: 600;
    border: 1px solid rgba(148,163,184,.35);
  }
  .swing-pill.entry-ok {
    background: var(--good);
    color: white;
    border-color: var(--good);
  }
  .swing-pill.entry-not-ok {
    background: rgba(148,163,184,.35);
    color: var(--muted);
  }
  .score-display {
    font-size: 48px;
    font-weight: 800;
    line-height: 1;
  }
  .score-bar {
    height: 12px;
    border-radius: 6px;
    background: rgba(148,163,184,.2);
    overflow: hidden;
  }
  .score-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--bad), var(--warn), var(--good));
    transition: width 0.3s ease;
  }
  .metric-card {
    padding: 12px;
    border: 1px solid rgba(148,163,184,.18);
    border-radius: 12px;
    background: rgba(148,163,184,.05);
  }
  .metric-label {
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .metric-value {
    font-size: 20px;
    font-weight: 700;
  }

  /* Risk management styles */
  .risk-switch {
    display: inline-flex;
    background: rgba(148,163,184,.1);
    border-radius: 999px;
    padding: 4px;
    position: relative;
  }
  .risk-switch-btn {
    padding: 8px 16px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    border-radius: 999px;
    font-weight: 600;
    transition: all 0.2s;
    position: relative;
    z-index: 2;
  }
  .risk-switch-btn.active {
    color: var(--fg);
  }
  .risk-switch-indicator {
    position: absolute;
    top: 4px;
    left: 4px;
    height: calc(100% - 8px);
    background: var(--card);
    border-radius: 999px;
    transition: all 0.3s ease;
    border: 1px solid rgba(148,163,184,.18);
  }

  /* Centered bottom credit */
  .site-credit {
    position: fixed;
    left: 50%;
    bottom: 10px;
    transform: translateX(-50%);
    font-size: 12px;
    color: var(--muted);
    z-index: 9999;
    pointer-events: none;
  }
</style>

</head>
<body data-theme="dark">
  <header>
    <div>
      <div class="title">Unified Financial Analyzer</div>
      <div class="muted small">Stock Evaluation + Swing Trade Quality — Comprehensive analysis toolkit.</div>
    </div>
    <div class="row">
      <button id="downloadHtml" class="btn small">Download (.html)</button>
      <label class="row small muted" style="gap:8px;">
        <span>Light</span>
        <input id="themeToggle" type="checkbox">
        <span class="pill">Theme</span>
      </label>
      <label class="row small muted" style="gap:8px;">
        <span>Debug</span>
        <input id="debugToggle" type="checkbox">
        <span class="pill">Show</span>
      </label>
    </div>
  </header>

  <div id="alerts" class="alerts"></div>

  <div class="container">
    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="stock-evaluation">Stock Evaluation (F-Score + ROIC)</button>
      <button class="tab-btn" data-tab="swing-trading">Swing Trade Quality</button>
    </nav>

    <!-- Stock Evaluation Tab -->
    <div id="stock-evaluation" class="tab-content active">
     <details class="card" id="helpCard" open="">
  <summary><strong>Help</strong> <span class="small muted">How to use, meanings, and where to find each input</span></summary>

  <div class="grid" style="grid-template-columns: 1fr; gap:14px; margin-top:10px;">

    <!-- 1) Quick Start -->
    <section>
      <label>Quick start</label>
      <ul style="margin:6px 0 0 18px">
        <li>Type a ticker (e.g., AAPL). Enter API keys if you plan to auto-fetch.</li>
        <li>Click one source at a time:
          <ul style="margin:6px 0 0 18px">
            <li>Fetch via Finnhub → tries “financials-reported”.</li>
            <li>Fetch via FMP → fills most basics, marks gaps as manual.</li>
            <li>Fetch via SEC → pulls from your SEC proxy.</li>
          </ul>
        </li>
        <li>Fill any remaining blanks. Red borders mean “still needed.”</li>
        <li>Press <b>Compute All</b>. Review F-Score, ROIC, Growth, Spread, and Verdict.</li>
        <li>Switch to <b>Swing Trade Quality</b> to score setups. Pick <b>Basic</b> or <b>Analyst + Technical</b>.</li>
        <li>Use <b>Risk Management</b> to size the trade and define exits.</li>
      </ul>
    </section>

    <!-- 2) Core Concepts -->
    <section>
      <label>Concepts and meanings</label>
      <ul style="margin:6px 0 0 18px">
        <li><b>Piotroski F-Score (0–9)</b>
          <ul style="margin:6px 0 0 18px" class="small muted">
            <li>Profitability: ROA &gt; 0; CFO &gt; 0; ΔROA &gt; 0; Accruals test (CFO &gt; NI).</li>
            <li>Leverage/Liquidity: LT Debt/Assets ↓; Current Ratio ↑; No new shares (current ≤ prior).</li>
            <li>Efficiency: Gross Margin ↑; Asset Turnover ↑.</li>
            <li>Read: 0–3 weak, 4–6 average, 7–9 strong.</li>
          </ul>
        </li>
        <li><b>ROIC</b> ≈ NOPAT / Invested Capital. Measures core return on operating capital.</li>
        <li><b>WACC</b> = blended required return for debt + equity.</li>
        <li><b>Spread</b> = ROIC − WACC. Positive → creating value. Negative → destroying value.</li>
        <li><b>Cumulative Growth (4y)</b> from your YoY revenue growth inputs. Class labels show strength.</li>
        <li><b>EBIT Margin</b> = EBIT / Revenue. Operating profitability.</li>
        <li><b>Net-Debt / EBITDA</b> gauges leverage vs cash earnings. Lower is safer.</li>
        <li><b>Composite Verdict</b> blends F-Score, Spread, and Growth class into a plain-English call.</li>
        <li><b>Swing Score (Basic)</b> = E/M/V/R buckets:
          <ul style="margin:6px 0 0 18px" class="small muted">
            <li>E: Zacks Rank (1 best, 5 worst).</li>
            <li>M: EPS positive? Basic momentum proxy.</li>
            <li>V: Valuation (P/E, EV/EBITDA, P/B) normalized.</li>
            <li>R: Dilution (3-yr Δ Shares Outstanding).</li>
          </ul>
        </li>
        <li><b>Swing Score (Analyst + Technical)</b> adds:
          <ul style="margin:6px 0 0 18px" class="small muted">
            <li>EPS/Revenue surprise (2 quarters), 30-day EPS revisions, relative strength vs SPY (6w).</li>
            <li>Trend guards (price above 20/50/200 DMA), breakout %, liquidity, beta, short interest.</li>
            <li>Forward valuation (Fwd P/E, PEG), EV/EBITDA vs industry “k_EV”.</li>
          </ul>
        </li>
        <li><b>Risk Management</b>
          <ul style="margin:6px 0 0 18px" class="small muted">
            <li><b>Fixed Target</b>: entry, stop %, target % → position size, R:R, rules.</li>
            <li><b>Trailing Stop</b>: entry, trail % → dynamic exit; target optional.</li>
            <li><b>Time Exit</b>: days-based exit guard you set up front.</li>
          </ul>
        </li>
      </ul>
    </section>

    <!-- 3) Where to find each input (Zacks first) -->
    <section>
      <label>Where to find each value</label>
      <div class="small muted" style="margin:6px 0 8px">Start on Zacks. If not available there, use the alternatives listed.</div>

      <ul style="margin:6px 0 0 18px">
        <li><b>Zacks Rank</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Quote Overview → “Zacks Rank”.</li>
            <li>Alt: Zacks “Rank” page for the ticker; Yahoo Finance “Analysis” (approximate via EPS revisions); brokerage terminal.</li>
          </ul>
        </li>

        <li><b>P/E, P/B, PEG, Fwd P/E, EV/EBITDA</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Valuation tab (P/E, P/B, PEG, Forward P/E, EV/EBITDA).</li>
            <li>Alt: TIKR, Finbox, GuruFocus, Seeking Alpha “Valuation”.</li>
          </ul>
        </li>

        <li><b>Industry EV/EBITDA (k_EV)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Industry Comparison / Valuation → “EV/EBITDA (Industry Avg)”.</li>
            <li>Alt: Finbox industry benchmarks, GuruFocus industry pages.</li>
          </ul>
        </li>

        <li><b>EPS Positive?</b> (checkbox)
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Quote Overview → “EPS (TTM)” or Income Statement (EPS basic/diluted).</li>
            <li>Alt: Yahoo Finance → “Financials” → Income Statement; company 10-K/10-Q.</li>
          </ul>
        </li>

        <li><b>EPS Surprise %, Revenue Surprise % (2q)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Earnings → “Earnings Surprise” and “Earnings ESP”.</li>
            <li>Alt: Seeking Alpha “Earnings”; Nasdaq.com “Earnings”; company press releases.</li>
          </ul>
        </li>

        <li><b>Δ EPS Consensus (30d)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Earnings → “Earnings Estimates” → revision trends.</li>
            <li>Alt: Yahoo Finance “Analysis” → EPS Trend/Revision; Seeking Alpha “Revisions”.</li>
          </ul>
        </li>

        <li><b>Rel Strength vs SPY (6w)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks does not show a 6-week SPY ratio directly.</li>
            <li>Alt: TradingView → compare ticker to SPY → Range = 1–1.5 months → read % outperformance.</li>
          </ul>
        </li>

        <li><b>Price &gt; 20/50/200 DMA</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Technicals (some tickers). If missing, use charting.</li>
            <li>Alt: TradingView/Yahoo Finance → add SMA(20/50/200) and check if price is above each.</li>
          </ul>
        </li>

        <li><b>Breakout % above swing high</b>
          <ul class="small muted" style="margin-left:18px">
            <li>From your chart: identify last swing-high, compute (Price − SwingHigh)/SwingHigh × 100.</li>
            <li>Alt: Any charting tool that shows recent highs.</li>
          </ul>
        </li>

        <li><b>Avg Daily Volume (millions), Beta</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → Quote Overview → “Price and Volume” (Avg Volume), “Beta”.</li>
            <li>Alt: Yahoo Finance “Statistics”; TradingView “Fundamentals”.</li>
          </ul>
        </li>

        <li><b>Short Interest % of Float</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Short Interest” page for the ticker.</li>
            <li>Alt: Nasdaq.com → Short Interest; MarketWatch; exchange short-interest reports.</li>
          </ul>
        </li>

        <li><b>Revenue, Gross Profit, Total Assets, Net Income, CFO</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Income Statement / Balance Sheet / Cash Flow.</li>
            <li>Alt: SEC 10-K/10-Q (Income Statement, Balance Sheet, Cash Flow); FMP/Finnhub API.</li>
          </ul>
        </li>

        <li><b>Long-term Debt, Current Assets, Current Liabilities</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Balance Sheet.</li>
            <li>Alt: SEC 10-K/10-Q; FMP/Finnhub.</li>
          </ul>
        </li>

        <li><b>Shares Outstanding (weighted avg)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Income Statement (weighted avg shares).</li>
            <li>Alt: 10-K/10-Q footnotes; FMP/Finnhub endpoints for share counts.</li>
          </ul>
        </li>

        <li><b>EBIT, EBITDA, Income Tax</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Income Statement (Operating Income ~ EBIT), Cash Flow for EBITDA if provided.</li>
            <li>Alt: SEC filings (Operating income, depreciation+amortization, tax expense); APIs.</li>
          </ul>
        </li>

        <li><b>Cash &amp; Equivalents, Short-term Debt, CPLTD, Term Debt</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Balance Sheet.</li>
            <li>Alt: SEC filings; APIs.</li>
          </ul>
        </li>

        <li><b>Common Stock, Capital Surplus, Retained Earnings</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Balance Sheet (Equity section).</li>
            <li>Alt: SEC filings; APIs.</li>
          </ul>
        </li>

        <li><b>Revenue Growth % (Y1–Y4)</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Zacks → “Financials” → Income Statement → compute YoY % from revenue history.</li>
            <li>Alt: FMP/Finnhub “income statement” history; company investor presentations.</li>
          </ul>
        </li>

        <li><b>WACC</b>
          <ul class="small muted" style="margin-left:18px">
            <li>Not typically on Zacks.</li>
            <li>Use: Finbox (WACC), TIKR, GuruFocus, AlphaSpread, or estimate from CAPM + debt costs.</li>
            <li>As a quick proxy, use industry WACC (Damodaran tables) if company-specific is unavailable.</li>
          </ul>
        </li>
      </ul>
    </section>

    <!-- 4) Data entry rules -->
    <section>
      <label>Data entry rules</label>
      <ul style="margin:6px 0 0 18px">
        <li>Use <b>the same currency and scale</b> across fields. Avoid mixing “in millions” with raw numbers.</li>
        <li>Prefer <b>TTM or full-year</b> consistently for NI, CFO, EBIT, etc. Do not mix quarterly with annual.</li>
        <li><b>Weighted-average shares</b> for F-Score dilution test (not end-of-period shares).</li>
        <li>If a field is missing, add a <b>note</b> (click “note”). Record your source and assumptions.</li>
        <li>Enter <b>percentages as numbers</b> (e.g., type 10 for 10%).</li>
      </ul>
    </section>

    <!-- 5) Swing inputs checklist -->
    <section>
      <label>Swing inputs checklist</label>
      <ul style="margin:6px 0 0 18px">
        <li>Basic: Zacks Rank, EPS Positive, P/E, EV/EBITDA, P/B, 3-yr Δ Shares%.</li>
        <li>Analyst + Technical: add EPS/Revenue surprises, EPS revisions 30d, RS vs SPY (6w), MAs, breakout %, volume, beta, short interest, Fwd P/E, PEG, EV/EBITDA vs industry.</li>
        <li>Ask yourself: Is price above key MAs? Is liquidity sufficient? Are revisions trending up?</li>
      </ul>
    </section>

    <!-- 6) Risk management how-to -->
    <section>
      <label>Risk management — how to use</label>
      <ul style="margin:6px 0 0 18px">
        <li>Enter <b>Account Size</b> and <b>Risk %</b>. That sets your max dollar loss per trade.</li>
        <li>Provide <b>Entry</b> and either:
          <ul style="margin:6px 0 0 18px" class="small muted">
            <li><b>Stop %</b> or <b>Stop Price</b>, plus optional <b>Target %/Price</b> for fixed-target mode.</li>
            <li><b>Trailing %</b> for trailing-stop mode.</li>
            <li><b>Time Exit (days)</b> for time-based guardrails.</li>
          </ul>
        </li>
        <li>Review <b>Position Size</b>, <b>Risk $ / Reward $</b>, <b>R:R</b>, and the generated <b>rules</b>.</li>
      </ul>
    </section>

    <!-- 7) Troubleshooting -->
    <section>
      <label>Troubleshooting</label>
      <ul style="margin:6px 0 0 18px">
        <li>Blanks highlighted in red → still required. Fill or add a note.</li>
        <li>APIs blocked when opening the file directly? Run a local server:
          <span class="mono">python -m http.server</span> and open <span class="mono">http://localhost:8000</span>.</li>
        <li>SEC fetch slow or partial? Try again or fill key fields manually from filings/Zacks.</li>
        <li>Numbers look off? Check units (thousands vs millions), TTM vs annual, and currency.</li>
      </ul>
    </section>

  </div>
</details>


      <div class="grid grid-cols-2">
      <!-- LEFT: Inputs & Fetch -->
      <section class="card">
        <div class="row">
          <label for="ticker">Ticker</label>
          <span class="help">what is this?
            <span class="popover">Enter a 1—5 letter ticker symbol (e.g., AAPL, MSFT, GOOG). Uppercase A—Z.</span>
          </span>
        </div>
        <input id="ticker" class="input round mono" maxlength="5" placeholder="e.g., AAPL" pattern="[A-Z]{1,5}">

        <div style="height:12px"></div>
        <div class="row"><span class="tag">Data Sources</span></div>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
          <div class="card" style="padding:12px;">
            <div class="row" style="justify-content:space-between;">
              <strong>Finnhub</strong>
              <a class="small" href="https://finnhub.io" target="_blank" rel="noopener">Get key</a>
            </div>
            <label class="small muted" for="finnhubKey">API Key</label>
            <div class="row" style="gap:8px;"><input id="finnhubKey" type="password" class="input mono" placeholder="FINNHUB_API_KEY"><button class="btn small" id="toggleFinnhubKey" title="Show/Hide">👁</button></div>
            <div style="height:8px"></div>
            <button class="btn" id="btnFinnhub">Fetch via Finnhub</button>
            <p class="small muted">Primary: financials-reported; Optional: metric for shares.</p>
          </div>

          <div class="card" style="padding:12px;">
            <div class="row" style="justify-content:space-between;">
              <strong>FMP</strong>
              <a class="small" href="https://site.financialmodelingprep.com/developer" target="_blank" rel="noopener">Get key</a>
            </div>
            <label class="small muted" for="fmpKey">API Key</label>
            <div class="row" style="gap:8px;"><input id="fmpKey" type="password" class="input mono" placeholder="FMP_API_KEY"><button class="btn small" id="toggleFmpKey" title="Show/Hide">👁</button></div>
            <div style="height:8px"></div>
            <button class="btn" id="btnFmp">Fetch via FMP</button>
            <p class="small muted">Quiet build: marks missing as manual.</p>
          </div>
        </div>
        <div style="height:12px"></div>
        <button class="btn" id="btnSec">Fetch via SEC</button>
        <p class="small muted">Direct from SEC via your Vercel proxy.</p>
        <div style="height:12px"></div>

        <!-- Unified Inputs -->
        <details open="" class="card">
          <summary><strong>Unified Inputs</strong> <span class="small muted">(auto-fill or manual; reused across all metrics)</span></summary>
          <div class="fieldset"><div class="uni-grid">
      <div class="uni-row">
        <label>Revenue / Sales</label>
        <div class="note-wrap">
          <input id="rev0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_rev0">note</span>
          <div class="note-box" id="note_rev0_box"><div class="note-head">Revenue / Sales note</div><textarea id="note_rev0"></textarea></div>
        </div>
        <div>
          <input id="rev1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Gross Profit</label>
        <div class="note-wrap">
          <input id="gp0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_gp0">note</span>
          <div class="note-box" id="note_gp0_box"><div class="note-head">Gross Profit note</div><textarea id="note_gp0"></textarea></div>
        </div>
        <div>
          <input id="gp1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Total Assets</label>
        <div class="note-wrap">
          <input id="assets0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_assets0">note</span>
          <div class="note-box" id="note_assets0_box"><div class="note-head">Total Assets note</div><textarea id="note_assets0"></textarea></div>
        </div>
        <div>
          <input id="assets1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Net Income</label>
        <div class="note-wrap">
          <input id="ni0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_ni0">note</span>
          <div class="note-box" id="note_ni0_box"><div class="note-head">Net Income note</div><textarea id="note_ni0"></textarea></div>
        </div>
        <div>
          <input id="ni1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Operating Cash Flow (CFO)</label>
        <div class="note-wrap">
          <input id="cfo0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_cfo0">note</span>
          <div class="note-box" id="note_cfo0_box"><div class="note-head">Operating Cash Flow (CFO) note</div><textarea id="note_cfo0"></textarea></div>
        </div>
        <div>
          <input id="cfo1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Long-term Debt</label>
        <div class="note-wrap">
          <input id="ltd0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_ltd0">note</span>
          <div class="note-box" id="note_ltd0_box"><div class="note-head">Long-term Debt note</div><textarea id="note_ltd0"></textarea></div>
        </div>
        <div>
          <input id="ltd1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Current Assets</label>
        <div class="note-wrap">
          <input id="ca0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_ca0">note</span>
          <div class="note-box" id="note_ca0_box"><div class="note-head">Current Assets note</div><textarea id="note_ca0"></textarea></div>
        </div>
        <div>
          <input id="ca1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Current Liabilities</label>
        <div class="note-wrap">
          <input id="cl0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_cl0">note</span>
          <div class="note-box" id="note_cl0_box"><div class="note-head">Current Liabilities note</div><textarea id="note_cl0"></textarea></div>
        </div>
        <div>
          <input id="cl1" class="input mono" placeholder="last year">
        </div>
      </div>

      <div class="uni-row">
        <label>Shares Outstanding (weighted avg)</label>
        <div class="note-wrap">
          <input id="sh0" class="input mono" placeholder="current year">
          <span class="note-toggle" data-for="note_sh0">note</span>
          <div class="note-box" id="note_sh0_box"><div class="note-head">Shares Outstanding (weighted avg) note</div><textarea id="note_sh0"></textarea></div>
        </div>
        <div>
          <input id="sh1" class="input mono" placeholder="last year">
        </div>
      </div>
  </div>
  <div class="full"><h4>Additional (for ROIC / Debt / Margins / Growth)</h4></div>
            <div class="note-wrap">
              <label>EBIT</label>
              <input id="ebit" class="input mono" placeholder="e.g., 1254">
              <span class="note-toggle" data-for="note_ebit">note</span>
              <div class="note-box" id="note_ebit_box"><div class="note-head">EBIT note</div><textarea id="note_ebit"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>EBITDA</label>
              <input id="ebitda" class="input mono" placeholder="e.g., 1571">
              <span class="note-toggle" data-for="note_ebitda">note</span>
              <div class="note-box" id="note_ebitda_box"><div class="note-head">EBITDA note</div><textarea id="note_ebitda"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Income Tax</label>
              <input id="tax" class="input mono" placeholder="e.g., 152">
              <span class="note-toggle" data-for="note_tax">note</span>
              <div class="note-box" id="note_tax_box"><div class="note-head">Income Tax note</div><textarea id="note_tax"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Cash &amp; Equivalents</label>
              <input id="cash" class="input mono" placeholder="e.g., 471">
              <span class="note-toggle" data-for="note_cash">note</span>
              <div class="note-box" id="note_cash_box"><div class="note-head">Cash &amp; Equivalents note</div><textarea id="note_cash"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Short-term Debt</label>
              <input id="std" class="input mono" placeholder="e.g., 0">
              <span class="note-toggle" data-for="note_std">note</span>
              <div class="note-box" id="note_std_box"><div class="note-head">Short-term Debt note</div><textarea id="note_std"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Current Portion of LT Debt</label>
              <input id="cpltd" class="input mono" placeholder="e.g., 307">
              <span class="note-toggle" data-for="note_cpltd">note</span>
              <div class="note-box" id="note_cpltd_box"><div class="note-head">CPLTD note</div><textarea id="note_cpltd"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Term Debt</label>
              <input id="termdebt" class="input mono" placeholder="e.g., 0">
              <span class="note-toggle" data-for="note_termdebt">note</span>
              <div class="note-box" id="note_termdebt_box"><div class="note-head">Term Debt note</div><textarea id="note_termdebt"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Common Stock</label>
              <input id="cs" class="input mono" placeholder="e.g., 181">
              <span class="note-toggle" data-for="note_cs">note</span>
              <div class="note-box" id="note_cs_box"><div class="note-head">Common Stock note</div><textarea id="note_cs"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Capital Surplus</label>
              <input id="cap" class="input mono" placeholder="e.g., 2189">
              <span class="note-toggle" data-for="note_cap">note</span>
              <div class="note-box" id="note_cap_box"><div class="note-head">Capital Surplus note</div><textarea id="note_cap"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Retained Earnings</label>
              <input id="re" class="input mono" placeholder="e.g., 9635">
              <span class="note-toggle" data-for="note_re">note</span>
              <div class="note-box" id="note_re_box"><div class="note-head">Retained Earnings note</div><textarea id="note_re"></textarea></div>
            </div>

            <div class="note-wrap">
              <label>Revenue Growth % (Y1)</label>
              <input id="r1" class="input mono" placeholder="e.g., 10">
              <span class="note-toggle" data-for="note_r1">note</span>
              <div class="note-box" id="note_r1_box"><div class="note-head">Growth Y1 note</div><textarea id="note_r1"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Revenue Growth % (Y2)</label>
              <input id="r2" class="input mono" placeholder="e.g., 12">
              <span class="note-toggle" data-for="note_r2">note</span>
              <div class="note-box" id="note_r2_box"><div class="note-head">Growth Y2 note</div><textarea id="note_r2"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Revenue Growth % (Y3)</label>
              <input id="r3" class="input mono" placeholder="e.g., 8">
              <span class="note-toggle" data-for="note_r3">note</span>
              <div class="note-box" id="note_r3_box"><div class="note-head">Growth Y3 note</div><textarea id="note_r3"></textarea></div>
            </div>
            <div class="note-wrap">
              <label>Revenue Growth % (Y4)</label>
              <input id="r4" class="input mono" placeholder="e.g., 6">
              <span class="note-toggle" data-for="note_r4">note</span>
              <div class="note-box" id="note_r4_box"><div class="note-head">Growth Y4 note</div><textarea id="note_r4"></textarea></div>
            </div>
          </div>
        </details>

        <div class="row" style="margin-top:12px; justify-content:space-between;">
          <button class="btn" id="btnCompute">Compute All</button>
          <span class="small muted">Blank fields are highlighted. Add notes via the "note" toggles.</span>
        </div>
      </section>

      <!-- RIGHT: Results -->
      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <strong>F-Score</strong>
          <div class="small muted">9 criteria</div>
        </div>
        <div id="scoreBlock" class="kpi" style="margin-top:8px;">
          <div>Total F-Score</div>
          <div class="score right" id="totalScore">0 / 9</div>
        </div>
        <div style="height:8px"></div>
        <div id="criteriaList" class="grid"><div class="kpi na"><div>ROA &gt; 0</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">ROA — (NI/Assets)</div></div><div class="kpi na"><div>CFO &gt; 0</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">CFO —</div></div><div class="kpi na"><div>ΔROA &gt; 0</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">ΔROA —</div></div><div class="kpi na"><div>Accruals (CFO &gt; NI)</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">CFO — vs NI —</div></div><div class="kpi na"><div>Leverage down</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">LT Debt/Assets — → — (prior → current)</div></div><div class="kpi na"><div>Current ratio up</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">CR — → — (prior → current)</div></div><div class="kpi na"><div>No new shares</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">Shares — → — (prior → current)</div></div><div class="kpi na"><div>Gross margin up</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">GM — → — (prior → current)</div></div><div class="kpi na"><div>Asset turnover up</div><div class="right">—</div><div class="small muted" style="grid-column:1 / -1">AT — → — (prior → current)</div></div></div>

        <div style="height:16px"></div>
        <div class="row" style="justify-content:space-between;">
          <strong>Data Fill Status</strong>
          <span class="small muted">Which API or method filled each field</span>
        </div>
        <div class="status-grid small muted" style="margin-top:6px; font-weight:600;">
          <div>Field</div><div>Source</div><div>Value</div>
        </div>
        <div id="statusList" class="status-grid small" style="margin-top:2px;"><div class="status-grid">
        <div>Revenue (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Gross Profit (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Total Assets (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Net Income (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>CFO (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>LT Debt (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Current Assets (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Current Liabilities (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Shares (Current)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Revenue (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Gross Profit (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Total Assets (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Net Income (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>CFO (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>LT Debt (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Current Assets (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Current Liabilities (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Shares (Prior)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>EBIT</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>EBITDA</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Income Tax</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Cash &amp; Equivalents</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Short-term Debt</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Current Portion of LT Debt</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Term Debt</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Common Stock</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Capital Surplus</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Retained Earnings</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Revenue Growth % (Y1)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Revenue Growth % (Y2)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Revenue Growth % (Y3)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div><div class="status-grid">
        <div>Revenue Growth % (Y4)</div>
        <div><span class="pill warn">—</span></div>
        <div class="mono">—</div>
      </div></div>

        <div class="footer small">ROIC uses operating capital only. Cash reused from Net-Debt section if ROIC cash blank. © 2025 Kevin Shokrollahi ALL RIGHT RESERVED</div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <strong>ROIC / Debt / Margins / Growth</strong>
          <div class="small muted">Snapshot</div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:8px;">
          <div class="kpi"><div>EBIT Margin</div><div class="right" id="ebitMarginOut">0.00%</div></div>
          <div class="kpi"><div>Net-Debt / EBITDA</div><div class="right" id="ndebtOut">0.00</div></div>
          <div class="kpi"><div>ROIC</div><div class="right" id="roicOut">0.00%</div></div>
          <div class="kpi"><div>Cumulative Growth (4y)</div><div class="right" id="cumOut">0.00%</div></div>
        </div>

        <div class="row" style="margin-top:10px; gap:8px;">
          <span class="chip">Growth Class: <span id="growthClass">Poor</span></span>
          <span class="chip" id="valueFlag">—</span>
          <span class="chip">Spread (ROIC − WACC): <span id="spread">—</span></span>
        </div>

        <div class="row" style="margin-top:10px;">
          <label for="wacc">WACC (%)</label>
          <input id="wacc" class="input mono" style="max-width:200px" placeholder="e.g., 10">
        </div>

        <div style="margin-top:14px" class="kpi na">
          <div>Notes</div>
          <div class="right" id="notes">Enter a WACC to see value creation or destruction.</div>
        </div>
      </section>

      <section class="card" id="verdictCard">
        <div class="row" style="justify-content:space-between;">
          <strong>Composite Verdict</strong>
          <div class="small muted">F-Score + ROIC vs WACC + Growth</div>
        </div>
        <div class="kpi" id="verdictBadge" style="margin-top:8px;">
          <div id="verdictLabel">Hold</div>
          <div class="right" id="verdictEmoji">◐</div>
        </div>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px; margin-top:8px;">
          <div class="kpi"><div>F-Score</div><div class="right" id="vFscore">0 / 9</div></div>
          <div class="kpi"><div>ROIC − WACC</div><div class="right" id="vSpread">—</div></div>
          <div class="kpi"><div>Growth Class</div><div class="right" id="vGrowthClass">Poor</div></div>
          <div class="kpi"><div>Cumulative Growth (4y)</div><div class="right" id="vGrowthNum">0.00%</div></div>
        </div>
        <div class="kpi na" style="margin-top:8px;">
          <div>Reasoning</div>
          <div class="right small" id="verdictReason">Missing: ROIC &amp; WACC (to compute spread).</div>
        </div>
      
      <!-- Factor Composite (Pilot) -->
      <section class="card" id="factorComposite">
        <div class="row" style="justify-content:space-between;">
          <strong>Factor Composite (Pilot)</strong>
          <div class="small muted">Value • Profitability • Growth • Momentum • Risk</div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:8px;">
          <div class="kpi"><div>EV / EBIT</div><div class="right" id="fc_ev_ebit">—</div></div>
          <div class="kpi"><div>P/B</div><div class="right" id="fc_pb">—</div></div>
          <div class="kpi"><div>FCF Yield</div><div class="right" id="fc_fcf_yield">—</div></div>
          <div class="kpi"><div>Interest Coverage</div><div class="right" id="fc_int_cov">—</div></div>
          <div class="kpi"><div>Accruals (Sloan)</div><div class="right" id="fc_accruals">—</div></div>
          <div class="kpi"><div>Net Debt / EBITDA</div><div class="right" id="fc_nd_ebitda">—</div></div>
        </div>

        <div class="row" style="margin-top:12px; gap:8px;">
          <span class="chip">Composite Score: <span id="fc_score">—</span></span>
          <span class="chip">Grade: <span id="fc_grade">—</span></span>
        </div>

        <details style="margin-top:10px;">
          <summary class="small muted" style="cursor:pointer;">Why this score?</summary>
          <table class="table" id="fc_table">
            <thead><tr><th>Factor</th><th>Metric</th><th>Value</th><th>Scaled</th><th>Weight</th></tr></thead>
            <tbody></tbody>
          </table>
        </details>
      </section>
</section>
      </div>
    </div>

    <!-- Swing Trading Tab -->
    <div id="swing-trading" class="tab-content">
      <!-- Model Switch -->
      <div class="row" style="margin-bottom:20px;">
        <div class="risk-switch" id="modelSwitch">
          <div class="risk-switch-indicator" id="modelIndicator" style="width: 50%; transform: translateX(0%);"></div>
          <button class="risk-switch-btn active" data-model="basic">Basic Swing</button>
          <button class="risk-switch-btn" data-model="analyst">Analyst + Technical</button>
        </div>
        <div class="row" style="margin-left: auto; gap: 8px;">
          <button id="demoA" class="btn small">Fill Demo A</button>
          <button id="demoB" class="btn small">Fill Demo B</button>
          <button id="resetBtn" class="btn small">Reset</button>
        </div>
      </div>

      <!-- Basic Model Panel -->
      <div id="basic-panel" class="grid grid-cols-2" style="display: grid;">
        <!-- Basic Inputs -->
        <section class="card">
          <h2 class="row" style="justify-content:space-between; margin-bottom:16px;">
            <strong>Inputs — Basic</strong>
            <span id="entryOkPill" class="swing-pill entry-not-ok">Entry Not OK</span>
          </h2>
          <div class="fieldset">
            <div>
              <label for="swing_ticker">Ticker</label>
              <input id="swing_ticker" class="input mono" placeholder="PLTR">
            </div>
            <div>
              <label for="zacks">Zacks Rank (1—5)</label>
              <select id="zacks" class="input">
                <option value="">—</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
            <div>
              <label for="pe">P/E</label>
              <input id="pe" type="number" step="0.01" min="0" class="input" placeholder="25">
            </div>
            <div>
              <label for="evebitda">EV/EBITDA</label>
              <input id="evebitda" type="number" step="0.01" class="input" placeholder="18">
            </div>
            <div>
              <label for="pb">P/B</label>
              <input id="pb" type="number" step="0.01" min="0" class="input" placeholder="6">
            </div>
            <div>
              <label for="dshares">Shares Outstanding Δ% (3y)</label>
              <input id="dshares" type="number" step="0.01" class="input" placeholder="-5 for −5%">
            </div>
            <div class="full row" style="gap:8px; margin-top:8px;">
              <input id="epspos" type="checkbox">
              <label for="epspos">EPS Positive? (check = yes)</label>
            </div>
          </div>
          <p class="small muted" style="margin-top:12px;">ΔShares% uses sign. Negative = buybacks. Positive = dilution.</p>
        </section>

        <!-- Basic Results -->
        <section class="card">
          <h2 style="margin-bottom:16px;"><strong>Result — Basic</strong></h2>
          <div class="row" style="gap:16px; margin-bottom:20px;">
            <div style="flex:1;">
              <div class="small muted">SW Score</div>
              <div id="scoreText" class="score-display">—</div>
              <div id="decisionText" style="font-weight:600; margin-top:4px;">Pass</div>
            </div>
            <div style="width:120px;">
              <div class="score-bar">
                <div id="scoreBar" class="score-fill" style="width:0%"></div>
              </div>
              <div class="small muted" style="margin-top:4px;">0—100</div>
            </div>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:16px;">
            <div class="metric-card">
              <div class="metric-label">E (Zacks)</div>
              <div id="E" class="metric-value">—</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">M (EPS)</div>
              <div id="M" class="metric-value">0.30</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">V (Valuation)</div>
              <div id="V" class="metric-value">1.00</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">R (Dilution)</div>
              <div id="R" class="metric-value">—</div>
            </div>
          </div>

          <details>
            <summary class="small muted" style="cursor:pointer;">Detailed Breakdown</summary>
            <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-top:8px;">
              <div class="metric-card">
                <div class="metric-label">n_pe</div>
                <div id="n_pe" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_ev</div>
                <div id="n_ev" style="font-size:14px; font-weight:600;">1.00</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_pb</div>
                <div id="n_pb" style="font-size:14px; font-weight:600;">1.00</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_dil</div>
                <div id="n_dil" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Raw Score</div>
                <div id="raw" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Rule</div>
                <div id="rule" style="font-size:10px;">&gt;=75 Setup-A, &gt;=60 Watch, &gt;=45 Speculative, else Pass</div>
              </div>
            </div>
          </details>
        </section>
      </div>

      <!-- Analyst Model Panel -->
      <div id="analyst-panel" class="grid" style="display:none;">
        <!-- Analyst Inputs -->
        <section class="card" style="grid-column: 1 / -1;">
          <h2 class="row" style="justify-content:space-between; margin-bottom:16px;">
            <strong>Inputs — Analyst + Technical</strong>
            <span id="entry2" class="swing-pill entry-not-ok">Entry Not OK</span>
          </h2>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:12px;">
            <div>
              <label for="swing_ticker2">Ticker</label>
              <input id="swing_ticker2" class="input mono" placeholder="PLTR">
            </div>
            <div>
              <label for="epsSurp">Avg EPS Surprise % (2q)</label>
              <input id="epsSurp" type="number" step="0.01" class="input" placeholder="5">
            </div>
            <div>
              <label for="revSurp">Avg Revenue Surprise % (2q)</label>
              <input id="revSurp" type="number" step="0.01" class="input" placeholder="2.5">
            </div>
            <div>
              <label for="epsRevise">Δ EPS Consensus (30d) %</label>
              <input id="epsRevise" type="number" step="0.01" class="input" placeholder="1.2">
            </div>
            <div>
              <label for="zacks2">Zacks Rank (1—5)</label>
              <select id="zacks2" class="input">
                <option value="">—</option>
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
              </select>
            </div>
            <div>
              <label for="rel6w">Rel Strength vs SPY (6w) %</label>
              <input id="rel6w" type="number" step="0.01" class="input" placeholder="6">
            </div>
            <div>
              <label for="brk">Breakout % above swing high</label>
              <input id="brk" type="number" step="0.01" class="input" placeholder="3">
            </div>
            <div>
              <label for="avgVol">Avg Daily Volume (millions)</label>
              <input id="avgVol" type="number" step="0.01" class="input" placeholder="1.2">
            </div>
            <div>
              <label for="beta">Beta (20—90d)</label>
              <input id="beta" type="number" step="0.01" class="input" placeholder="1.3">
            </div>
            <div>
              <label for="si">Short Interest % of float</label>
              <input id="si" type="number" step="0.01" class="input" placeholder="4">
            </div>
            <div>
              <label for="fpe">Forward P/E</label>
              <input id="fpe" type="number" step="0.01" class="input" placeholder="30">
            </div>
            <div>
              <label for="pe5">P/E 5yr Avg</label>
              <input id="pe5" type="number" step="0.01" class="input" placeholder="35">
            </div>
            <div>
              <label for="peg">PEG (1y fwd)</label>
              <input id="peg" type="number" step="0.01" class="input" placeholder="1.8">
            </div>
            <div>
              <label for="ev2">EV/EBITDA</label>
              <input id="ev2" type="number" step="0.01" class="input" placeholder="22">
            </div>
            <div>
              <label for="kev">Industry EV/EBITDA (k_EV)</label>
              <input id="kev" type="number" step="0.01" class="input" placeholder="18">
            </div>
          </div>
          
          <div class="row" style="gap:16px; margin-top:16px; flex-wrap:wrap;">
            <label class="row" style="gap:8px;">
              <input id="dma20" type="checkbox">
              <span>Price &gt; 20DMA</span>
            </label>
            <label class="row" style="gap:8px;">
              <input id="dma50" type="checkbox">
              <span>Price &gt; 50DMA</span>
            </label>
            <label class="row" style="gap:8px;">
              <input id="dma200" type="checkbox">
              <span>Price &gt; 200DMA</span>
            </label>
            <label class="row" style="gap:8px;">
              <input id="earn5" type="checkbox">
              <span>Earnings in next 5 trading days?</span>
            </label>
          </div>
        </section>

        <!-- Analyst Results -->
        <section class="card" style="grid-column: 1 / -1;">
          <div class="grid grid-cols-2">
            <!-- Main Results -->
            <div>
              <h3 style="margin-bottom:16px;"><strong>Result — Analyst + Technical</strong></h3>
              <div class="row" style="gap:16px; margin-bottom:20px;">
                <div style="flex:1;">
                  <div class="small muted">SW Score (Model B)</div>
                  <div id="score2" class="score-display">—</div>
                  <div id="decision2" style="font-weight:600; margin-top:4px;">Pass</div>
                </div>
                <div style="width:120px;">
                  <div class="score-bar">
                    <div id="bar2" class="score-fill" style="width:0%"></div>
                  </div>
                  <div class="small muted" style="margin-top:4px;">0—100</div>
                </div>
              </div>

              <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
                <div class="metric-card">
                  <div class="metric-label">E</div>
                  <div id="E2" class="metric-value">—</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">M</div>
                  <div id="M2" class="metric-value">—</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">V</div>
                  <div id="V2" class="metric-value">—</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">R</div>
                  <div id="R2" class="metric-value">—</div>
                </div>
              </div>
            </div>

            <!-- No-Analyst Variant -->
            <div>
              <h3 style="margin-bottom:16px;"><strong>Swing No-Analyst</strong> <span class="small muted">(price + liquidity only)</span></h3>
              <div class="row" style="gap:16px; margin-bottom:20px;">
                <div style="flex:1;">
                  <div class="small muted">SW Score (No-Analyst)</div>
                  <div id="scoreNA" style="font-size:36px; font-weight:800;">—</div>
                  <div id="decisionNA" style="font-weight:600; margin-top:4px;">Pass</div>
                </div>
                <div style="width:120px;">
                  <div class="score-bar">
                    <div id="barNA" class="score-fill" style="width:0%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Detailed Breakdown -->
          <details style="margin-top:20px;">
            <summary class="small muted" style="cursor:pointer;">Detailed Breakdown</summary>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:8px; margin-top:12px;">
              <div class="metric-card">
                <div class="metric-label">n_eps_surp</div>
                <div id="n_eps_surp" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_rev_surp</div>
                <div id="n_rev_surp" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_revise</div>
                <div id="n_revise" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_zacks</div>
                <div id="n_zacks2" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_rel</div>
                <div id="n_rel" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_ma</div>
                <div id="n_ma" style="font-size:14px; font-weight:600;">0.00</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_brk</div>
                <div id="n_brk" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_vol</div>
                <div id="n_vol" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_beta</div>
                <div id="n_beta" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_si</div>
                <div id="n_si" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_fpe</div>
                <div id="n_fpe" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_peg</div>
                <div id="n_peg" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">n_ev</div>
                <div id="n_ev2" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Raw Score</div>
                <div id="raw2" style="font-size:14px; font-weight:600;">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Guards</div>
                <div id="guards2" style="font-size:10px; font-weight:600;">—</div>
              </div>
            </div>
          </details>
        </section>
      </div>

      <!-- Risk Management (Shared) -->
      <section class="card" style="margin-top:20px;">
        <div class="row" style="justify-content:space-between; margin-bottom:16px;">
          <h2><strong>Risk Management</strong></h2>
          <div class="risk-switch" id="riskSwitch">
            <div class="risk-switch-indicator" id="riskIndicator" style="width: 33.3333%; transform: translateX(0%);"></div>
            <button class="risk-switch-btn active" data-risk="fixed">Fixed Target</button>
            <button class="risk-switch-btn" data-risk="trail">Trailing Stop</button>
            <button class="risk-switch-btn" data-risk="time">Time Exit</button>
          </div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr 2fr; gap:20px;">
          <!-- Risk Inputs -->
          <div>
            <div class="fieldset">
              <div>
                <label>Account Size ($)</label>
                <input id="acct" type="number" class="input" placeholder="25000">
              </div>
              <div>
                <label>Risk per Trade (%)</label>
                <input id="riskpct" type="number" step="0.01" class="input" placeholder="1">
              </div>
              <div>
                <label>Entry Price</label>
                <input id="entryPx" type="number" step="0.01" class="input" placeholder="20.00">
              </div>
              <div>
                <label>Stop-Loss % (or leave blank)</label>
                <input id="stopPct" type="number" step="0.01" class="input" placeholder="5">
              </div>
              <div>
                <label>Stop-Loss Price (optional)</label>
                <input id="stopPx" type="number" step="0.01" class="input" placeholder="19.00">
              </div>
              <div>
                <label>Target % (Fixed Target)</label>
                <input id="targetPct" type="number" step="0.01" class="input" placeholder="10">
              </div>
              <div>
                <label>Target Price (optional)</label>
                <input id="targetPx" type="number" step="0.01" class="input" placeholder="22.00">
              </div>
              <div>
                <label>Trailing Stop %</label>
                <input id="trailPct" type="number" step="0.01" class="input" placeholder="7">
              </div>
              <div>
                <label>Time Exit (days)</label>
                <input id="timeDays" type="number" step="1" class="input" placeholder="15">
              </div>
            </div>
          </div>

          <!-- Risk Visual & Metrics -->
          <div>
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:16px;">
              <div class="metric-card">
                <div class="metric-label">Position Size (shares)</div>
                <div id="posShares" class="metric-value">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Risk $ / Reward $</div>
                <div id="riskReward" class="metric-value">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">R:R</div>
                <div id="rratio" class="metric-value">—</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Stops &amp; Exits</div>
                <div id="rulesOut" style="font-size:12px; font-weight:600;">Target —, Stop —</div>
              </div>
            </div>
            <div class="card" style="padding:16px; background:rgba(148,163,184,.05);">
              <svg id="rrChart" viewBox="0 0 800 90" style="width:100%; height:80px;"></svg>
            </div>
          </div>
        </div>
      </section>

      <div class="small muted" style="margin-top:20px; text-align:center;">
        Model A: 40%E, 25%M, 20%V, 15%R. Model B: 35%E, 35%M, 20%V, 10%R. No-Analyst: 60%M, 40%R.
      </div>
    </div>
  </div>

<script>
  // Theme
  const toggle = document.getElementById('themeToggle');
  const body = document.body;
  const applyTheme = (light) => { if (light) body.classList.add('light'); else body.classList.remove('light'); };
  toggle.addEventListener('change', (e) => applyTheme(e.target.checked));

  // Alerts (quiet)
  const alertsEl = document.getElementById('alerts');
  function showAlert(msg) {
    const div = document.createElement('div');
    div.className = 'alert warn';
    div.textContent = msg;
    alertsEl.appendChild(div);
  }
  if (location.protocol === 'file:') {
    showAlert('APIs may block file:// requests. Serve over http(s) (e.g., python -m http.server).');
  }

  // Download current HTML
  document.getElementById('downloadHtml').addEventListener('click', () => {
    const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'unified_financial_analyzer.html';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  });

  // Tab System
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      
      // Update nav
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Update content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tab).classList.add('active');
    });
  });

  // Helpers
  const g = (id) => document.getElementById(id);
  const parseNum = (v) => {
    if (v === null || v === undefined) return NaN;
    if (typeof v === 'number') return v;
    const s = (v+'').replace(/,/g,'').trim();
    const n = parseFloat(s);
    return Number.isFinite(n) ? n : NaN;
  };
  const num = (id) => parseNum(g(id).value);
  const setVal = (id, v) => { g(id).value = (v ?? '') + ''; };
  const isEmpty = (id) => (g(id).value ?? '').toString().trim() === '';

  // Notes toggling + autosave
  const NOTE_FIELDS = ['rev0','gp0','assets0','ni0','cfo0','ltd0','ca0','cl0','sh0','ebit','ebitda','tax','cash','std','cpltd','termdebt','cs','cap','re','r1','r2','r3','r4'];
  function wireNotes(){
    document.querySelectorAll('.note-toggle').forEach(el=>{
      const target = el.getAttribute('data-for');
      const box = document.getElementById(target + '_box');
      el.addEventListener('click', ()=>{
        box.style.display = (box.style.display === 'block') ? 'none' : 'block';
      });
    });
    // Auto-save
    [...NOTE_FIELDS].forEach(id=>{
      const ta = document.getElementById('note_' + id);
      if(!ta) return;
      const key = 'unified_note_' + id;
      const saved = localStorage.getItem(key);
      if(saved !== null) ta.value = saved;
      ta.addEventListener('input', ()=> localStorage.setItem(key, ta.value));
    });
  }
  wireNotes();

  // Status rows
  const FIELDS = [
    ['rev0','Revenue (Current)'],['gp0','Gross Profit (Current)'],['assets0','Total Assets (Current)'],
    ['ni0','Net Income (Current)'],['cfo0','CFO (Current)'],['ltd0','LT Debt (Current)'],
    ['ca0','Current Assets (Current)'],['cl0','Current Liabilities (Current)'],['sh0','Shares (Current)'],
    ['rev1','Revenue (Prior)'],['gp1','Gross Profit (Prior)'],['assets1','Total Assets (Prior)'],
    ['ni1','Net Income (Prior)'],['cfo1','CFO (Prior)'],['ltd1','LT Debt (Prior)'],
    ['ca1','Current Assets (Prior)'],['cl1','Current Liabilities (Prior)'],['sh1','Shares (Prior)'],
    ['ebit','EBIT'],['ebitda','EBITDA'],['tax','Income Tax'],['cash','Cash & Equivalents'],
    ['std','Short-term Debt'],['cpltd','Current Portion of LT Debt'],['termdebt','Term Debt'],
    ['cs','Common Stock'],['cap','Capital Surplus'],['re','Retained Earnings'],
    ['r1','Revenue Growth % (Y1)'],['r2','Revenue Growth % (Y2)'],['r3','Revenue Growth % (Y3)'],['r4','Revenue Growth % (Y4)']
  ];
  const status = Object.fromEntries(FIELDS.map(([id]) => [id, {source: '', value: NaN}]));

  // Aux for computed fallbacks
  const AUX = { cor0: NaN, cor1: NaN, tdebt0: NaN, tdebt1: NaN };
  let lastAttempt = '';

  function mark(id, source, value, opts={}) {
    if (!isEmpty(id) && !opts.force) return;
    const n = parseNum(value);
    if (!Number.isNaN(n)) { setVal(id, n); status[id] = {source, value:n}; }
  }
  function ensureComputedFallbacks() {
    // GP = Revenue - COR if needed
    const tryGP = (gpId, revId, cor) => {
      const gp = num(gpId), rev = num(revId);
      if (!Number.isFinite(gp) && Number.isFinite(rev) && Number.isFinite(cor)) {
        const val = rev - cor;
        setVal(gpId, val);
        status[gpId] = {source:'Computed', value: val};
      }
    };
    tryGP('gp0','rev0',AUX.cor0);
    tryGP('gp1','rev1',AUX.cor1);

    // LT Debt from total debt if needed
    const tryLTD = (ltdId, tdebt) => {
      const ltd = num(ltdId);
      if (!Number.isFinite(ltd) && Number.isFinite(tdebt)) {
        setVal(ltdId, tdebt);
        status[ltdId] = {source:'Computed (from totalDebt)', value:tdebt};
      }
    };
    tryLTD('ltd0',AUX.tdebt0);
    tryLTD('ltd1',AUX.tdebt1);
  }
  function finalizeStatusAfterFetch() {
    if (!lastAttempt) return;
    for (const [id] of FIELDS) {
      const v = g(id).value;
      const has = v !== '' && Number.isFinite(parseNum(v));
      if (!has) { status[id] = {source:'manual input required', value: '—'}; }
    }
    renderStatus();
  }
  function renderStatus() {
    const el = g('statusList');
    el.innerHTML = '';
    for (const [id, label] of FIELDS) {
      const st = status[id];
      const val = Number.isFinite(parseNum(st.value)) ? st.value : '—';
      let pillClass = 'pill warn';
      if (st.source === 'FMP' || st.source?.startsWith('Finnhub') || st.source === 'Computed' || st.source?.startsWith('Computed')) pillClass = 'pill ok';
      if (st.source === 'manual input required' || st.source === 'manual input') pillClass = 'pill bad';
      const row = document.createElement('div');
      row.className = 'status-grid';
      row.innerHTML = `
        <div>${label}</div>
        <div><span class="${pillClass}">${st.source || '—'}</span></div>
        <div class="mono">${Number.isFinite(parseNum(val)) ? new Intl.NumberFormat('en-US', {maximumFractionDigits:2}).format(val) : '—'}</div>
      `;
      el.appendChild(row);
    }
  }

  // F-Score compute
  function fmt(x) {
    if (x === undefined || x === null || isNaN(x)) return '—';
    if (Math.abs(x) >= 1000) return new Intl.NumberFormat('en-US', {maximumFractionDigits:2}).format(x);
    return (Math.abs(x) >= 1 ? x.toFixed(2) : x.toExponential(2));
  }
  function computeFScore(){
    const rev0 = num('rev0'), rev1 = num('rev1');
    const gp0 = num('gp0'), gp1 = num('gp1');
    const assets0 = num('assets0'), assets1 = num('assets1');
    const ni0 = num('ni0'), ni1 = num('ni1');
    const cfo0 = num('cfo0'), cfo1 = num('cfo1');
    const ltd0 = num('ltd0'), ltd1 = num('ltd1');
    const ca0 = num('ca0'), ca1 = num('ca1');
    const cl0 = num('cl0'), cl1 = num('cl1');
    const sh0 = num('sh0'), sh1 = num('sh1');
    const have = (x) => Number.isFinite(x);

    const roa = have(assets0) ? ni0 / assets0 : NaN;
    const roa1 = have(assets1) ? ni1 / assets1 : NaN;
    const gm0 = have(rev0) && have(gp0) ? gp0 / rev0 : NaN;
    const gm1 = have(rev1) && have(gp1) ? gp1 / rev1 : NaN;
    const at0 = have(assets0) && have(rev0) ? rev0 / assets0 : NaN;
    const at1 = have(assets1) && have(rev1) ? rev1 / assets1 : NaN;
    const lvr0 = have(assets0) ? (have(ltd0) ? ltd0 : 0) / assets0 : NaN;
    const lvr1 = have(assets1) ? (have(ltd1) ? ltd1 : 0) / assets1 : NaN;
    const cr0 = have(cl0) && have(ca0) ? ca0 / cl0 : NaN;
    const cr1 = have(cl1) && have(ca1) ? ca1 / cl1 : NaN;

    const results = {
      roa, roa1, gm0, gm1, at0, at1, lvr0, lvr1, cr0, cr1,
      cfo0, ni0, sh0, sh1,
      roaPos: have(roa) ? roa > 0 : null,
      cfoPos: have(cfo0) ? cfo0 > 0 : null,
      deltaRoa: (have(roa) && have(roa1)) ? (roa - roa1) > 0 : null,
      accruals: (have(cfo0) && have(ni0)) ? cfo0 > ni0 : null,
      leverageDown: (have(lvr0) && have(lvr1)) ? (lvr0 - lvr1) < 0 : null,
      crUp: (have(cr0) && have(cr1)) ? (cr0 - cr1) > 0 : null,
      noNewShares: (have(sh0) && have(sh1)) ? (sh0 <= sh1) : null,
      gmUp: (have(gm0) && have(gm1)) ? (gm0 - gm1) > 0 : null,
      atUp: (have(at0) && have(at1)) ? (at0 - at1) > 0 : null,
    };
    renderCriteria(results);
  }
  function renderCriteria(results) {
    const list = g('criteriaList');
    list.innerHTML = '';
    let score = 0;
    const rows = [
      ['ROA > 0', results.roaPos, `ROA ${fmt(results.roa)} (NI/Assets)`],
      ['CFO > 0', results.cfoPos, `CFO ${fmt(results.cfo0)}`],
      ['ΔROA > 0', results.deltaRoa, `ΔROA ${fmt(results.roa - results.roa1)}`],
      ['Accruals (CFO > NI)', results.accruals, `CFO ${fmt(results.cfo0)} vs NI ${fmt(results.ni0)}`],
      ['Leverage down', results.leverageDown, `LT Debt/Assets ${fmt(results.lvr1)} → ${fmt(results.lvr0)} (prior → current)`],
      ['Current ratio up', results.crUp, `CR ${fmt(results.cr1)} → ${fmt(results.cr0)} (prior → current)`],
      ['No new shares', results.noNewShares, `Shares ${fmt(results.sh1)} → ${fmt(results.sh0)} (prior → current)`],
      ['Gross margin up', results.gmUp, `GM ${fmt(results.gm1)} → ${fmt(results.gm0)} (prior → current)`],
      ['Asset turnover up', results.atUp, `AT ${fmt(results.at1)} → ${fmt(results.at0)} (prior → current)`],
    ];
    for (const [name, ok, note] of rows) {
      let klass = 'kpi bad';
      let point = '0';
      if (ok === true) { klass = 'kpi good'; point = '1'; score += 1; }
      if (ok === null) { klass = 'kpi na'; point = '—'; }
      const div = document.createElement('div');
      div.className = klass;
      div.innerHTML = `<div>${name}</div><div class="right">${point}</div><div class="small muted" style="grid-column:1 / -1">${note}</div>`;
      list.appendChild(div);
    }
    document.getElementById('totalScore').textContent = score + ' / 9';
  }

  // ROIC / Debt / Margins / Growth compute
  function pct(n){ return (isFinite(n) ? n : 0).toFixed(2) + '%'; }
  function fix(n, d=2){ return (isFinite(n) ? n : 0).toFixed(d); }
  function classifyGrowth(p){
    if (p < 25) return 'Poor';
    if (p >= 25 && p < 30) return 'Below average';
    if (p >= 30 && p < 50) return 'Acceptable';
    if (p >= 50 && p < 60) return 'Decent';
    if (p >= 60 && p < 80) return 'Strong';
    if (p >= 80 && p <= 120) return 'Excellent';
    return (p > 120) ? 'Outlier' : '—';
  }
  function computeSnapshot(){
  // EBIT Margin
  const EBIT  = parseNum(g('ebit').value);
  const Sales = parseNum(g('rev0').value);
  const ebitMargin = Sales !== 0 ? (EBIT / Sales) * 100 : 0;
  g('ebitMarginOut').textContent = pct(ebitMargin);

  // Net-debt / EBITDA (unchanged)
  const std   = parseNum(g('std').value);
  const ltd   = parseNum(g('ltd0').value);
  const cpltd = parseNum(g('cpltd').value);
  const termd = parseNum(g('termdebt').value);
  const cash  = parseNum(g('cash').value);
  const ebitda = parseNum(g('ebitda').value);
  const netDebt = (std||0) + (ltd||0) + (cpltd||0) + (termd||0) - (cash||0);
  const ndRatio = ebitda !== 0 ? netDebt / ebitda : 0;
  g('ndebtOut').textContent = fix(ndRatio, 2);

  // ROIC — NOPAT with tax rate; operating invested capital
  const taxExp = parseNum(g('tax').value);
  // infer tax rate; clamp 0—45%
  let taxRate = 0.21;
  if (Number.isFinite(taxExp) && Number.isFinite(EBIT) && EBIT > 0 && taxExp >= 0) {
    taxRate = Math.max(0, Math.min(0.45, taxExp / EBIT));
  } else if (Number.isFinite(EBIT) && EBIT <= 0) {
    taxRate = 0;
  }
  const NOPAT = (EBIT || 0) * (1 - taxRate);

  
  // Operating Invested Capital (software/asset-light friendly)
  // Use: Invested = Total Assets − Cash − Non-interest-bearing Current Liabilities
  // where NIBCL = Current Liabilities − Short-term Debt − CPLTD.
  const ca = parseNum(g('ca0').value);
  const cl = parseNum(g('cl0').value);
  const assets = parseNum(g('assets0').value);

  const operCL = Math.max(0, (cl||0) - (std||0) - (cpltd||0));
  let invested = Math.max(0, (assets||0) - (cash||0) - operCL);

  // Fallback if inputs are incomplete: equity + interest-bearing debt − cash
  if (!Number.isFinite(invested) || invested <= 0){
    const cs = parseNum(g('cs').value);
    const cap = parseNum(g('cap').value);
    const re  = parseNum(g('re').value);
    invested = ((ltd||0) + (cpltd||0) + (termd||0) + (std||0))
             + ((cs||0) + (cap||0) + (re||0))
             - (cash||0);
  }
const roic = (Number.isFinite(invested) && Math.abs(invested) > 1e-9)
    ? (NOPAT / invested) * 100
    : 0;
  g('roicOut').textContent = pct(roic);

  // Growth (unchanged)
  const r1 = parseNum(g('r1').value)/100;
  const r2 = parseNum(g('r2').value)/100;
  const r3 = parseNum(g('r3').value)/100;
  const r4 = parseNum(g('r4').value)/100;
  const cg = ((1+(r1||0))*(1+(r2||0))*(1+(r3||0))*(1+(r4||0)) - 1) * 100;
  g('cumOut').textContent = pct(cg);
  g('growthClass').textContent = classifyGrowth(cg);

  // WACC comparison
  const wacc = parseNum(g('wacc').value);
  if ((g('wacc').value||'').trim().length){
    const spread = roic - (wacc||0);
    g('spread').textContent = spread.toFixed(2) + '%';
    if (spread > 0.5){
      g('valueFlag').textContent = 'Value creating';
      g('valueFlag').className = 'chip ok';
      g('notes').textContent = 'ROIC exceeds WACC. Positive spread.';
    } else if (spread >= -0.5 && spread <= 0.5){
      g('valueFlag').textContent = 'About break-even';
      g('valueFlag').className = 'chip warn';
      g('notes').textContent = 'ROIC roughly equals WACC.';
    } else {
      g('valueFlag').textContent = 'Value destroying';
      g('valueFlag').className = 'chip bad';
      g('notes').textContent = 'ROIC below WACC. Negative spread.';
    }
  } else {
    g('spread').textContent = '—';
    g('valueFlag').textContent = '—';
    g('valueFlag').className = 'chip';
    g('notes').textContent = 'Enter a WACC to see value creation or destruction.';
  }
}

function computeVerdict(){
  try{
    const V = (window.V = window.V || {});

    // Read current panel values
    const scoreText = (document.getElementById('totalScore')?.textContent||'').split('/')[0].trim();
    const spreadTxt = (document.getElementById('spread')?.textContent||'').replace('%','').trim();
    const roicTxt   = (document.getElementById('roicOut')?.textContent||'').replace('%','').trim();
    const cgTxt     = (document.getElementById('cumOut')?.textContent||'').replace('%','').trim();
    const gClassTxt = (document.getElementById('growthClass')?.textContent||'—').trim();
    const waccTxt   = (document.getElementById('wacc')?.value||'').replace('%','').trim();

    const fParsed = parseFloat(scoreText);
    const sParsed = parseFloat(spreadTxt);
    const rParsed = parseFloat(roicTxt);
    const gParsed = parseFloat(cgTxt);
    const wParsed = parseFloat(waccTxt);

    // Compute spread if missing or stale
    let spreadVal = Number.isFinite(sParsed) ? sParsed : null;
    if ((spreadVal==null || isNaN(spreadVal)) && Number.isFinite(rParsed) && Number.isFinite(wParsed)){
      spreadVal = rParsed - wParsed;
      const spreadEl = document.getElementById('spread');
      if (spreadEl) spreadEl.textContent = spreadVal.toFixed(2) + '%';
    }

    // Determine growth class if blank
    let growthClass = (gClassTxt && gClassTxt !== '—') ? gClassTxt : null;
    if (!growthClass && Number.isFinite(gParsed)){
      growthClass = (gParsed < 25) ? 'Poor'
                   : (gParsed < 30) ? 'Below average'
                   : (gParsed < 50) ? 'Acceptable'
                   : (gParsed < 80) ? 'Strong'
                   : (gParsed <=120) ? 'Excellent'
                   : 'Outlier';
      const gEl = document.getElementById('growthClass');
      if (gEl) gEl.textContent = growthClass;
    }

    V.fscore = Number.isFinite(fParsed) ? fParsed : null;
    V.roic   = Number.isFinite(rParsed) ? rParsed : null;
    V.spread = Number.isFinite(spreadVal) ? spreadVal : null;
    V.growthPct  = Number.isFinite(gParsed) ? gParsed : null;
    V.growthClass= growthClass || '—';

    // Verdict panel fields
    const vLabel = document.getElementById('verdictLabel');
    const vBadge = document.getElementById('verdictBadge');
    const vEmoji = document.getElementById('verdictEmoji');
    const vReason= document.getElementById('verdictReason');
    const vFs = document.getElementById('vFscore');
    const vSp = document.getElementById('vSpread');
    const vGc = document.getElementById('vGrowthClass');
    const vGn = document.getElementById('vGrowthNum');
    if (vFs) vFs.textContent = (V.fscore!=null) ? (V.fscore + ' / 9') : '—';
    if (vSp) vSp.textContent = (V.spread!=null) ? (V.spread.toFixed(2) + '%') : '—';
    if (vGc) vGc.textContent = V.growthClass || '—';
    if (vGn) vGn.textContent = (V.growthPct!=null) ? (V.growthPct.toFixed(2) + '%') : '—';

    // If we lack core inputs, set to Hold to avoid "Avoid" wording
    if (V.fscore==null || V.spread==null){
      if (vLabel) vLabel.textContent = 'Hold';
      if (vEmoji) vEmoji.textContent = '◐';
      if (vBadge) vBadge.className = 'kpi';
      if (vReason){
        const miss = [
          V.fscore==null ? 'F-Score' : null,
          V.spread==null ? 'ROIC & WACC (to compute spread)' : null
        ].filter(Boolean).join(', ');
        vReason.textContent = miss ? ('Missing: ' + miss + '.') : '';
      }
      return;
    }

    // Normalize inputs into a composite
    const fScoreNorm = Math.max(0, Math.min(1, (V.fscore ?? 0) / 9));
    const spreadScore =
      (V.spread <= -5) ? 0 :
      (V.spread <  -.5)? 0.15 :
      (V.spread <= .5)? 0.35 :
      (V.spread <= 5) ? 0.60 :
      (V.spread <=15) ? 0.80 : 1.00;

    const growthScore =
      (V.growthPct==null) ? 0.5 :
      (V.growthPct < 25) ? 0.00 :
      (V.growthPct < 30) ? 0.35 :
      (V.growthPct < 50) ? 0.55 :
      (V.growthPct < 80) ? 0.75 :
      (V.growthPct <=120)? 0.90 : 1.00;

    const composite = 0.45*spreadScore + 0.35*fScoreNorm + 0.20*growthScore;

    // Map to 5 fixed labels only
    let verdict = 'Hold';
    let badge   = 'kpi';
    if (composite >= 0.80){ verdict = 'Strong Buy'; badge = 'kpi good'; }
    else if (composite >= 0.65){ verdict = 'Buy'; badge = 'kpi good'; }
    else if (composite >= 0.45){ verdict = 'Hold'; badge = 'kpi'; }
    else if (composite >= 0.30){ verdict = 'Sell'; badge = 'kpi bad'; }
    else { verdict = 'Strong Sell'; badge = 'kpi bad'; }

    if (vLabel) vLabel.textContent = verdict;
    if (vBadge) vBadge.className = badge;
    if (vEmoji) vEmoji.textContent = verdict in {'Strong Buy':1,'Buy':1} ? '✓' : (verdict in {'Hold':1} ? '◐' : '×');

    // Reason line
    const reasons = [];
    reasons.push(`F-Score ${V.fscore}/9`);
    reasons.push(`Spread ${V.spread.toFixed(2)}%`);
    reasons.push(`Growth ${V.growthPct!=null ? V.growthPct.toFixed(2)+'%' : '—'}`);
    reasons.push(`Composite ${(composite*100).toFixed(0)}/100`);
    if (vReason) vReason.textContent = reasons.join(' • ');
  }catch(e){
    // fail safe
    const vLabel = document.getElementById('verdictLabel');
    const vBadge = document.getElementById('verdictBadge');
    if (vLabel) vLabel.textContent = 'Hold';
    if (vBadge) vBadge.className = 'kpi';
  }
}

  // Compute all function
  function computeAll() {
    computeFScore();
    computeSnapshot();
    computeVerdict();
  }

  // (Rest of your existing JS continues...)
</script>

<!-- Centered bottom credit -->
<div class="site-credit">© 2025 Kevin Shokrollahi</div>

</body>
</html>
